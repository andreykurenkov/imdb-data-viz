<html>
  <head>
    <link rel="stylesheet" href="./style.css">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.1.6.min.js"></script>
     <meta charset="UTF-8">
  </head>
  <body>
  	<div id="chartContainer">
  	  <script type="text/javascript">
        var genres = ["Action","Animation","Comedy","Drama","Documentary","Romance"];
    	var svg = dimple.newSvg("#chartContainer", 700, 400);

        d3.tsv("movies.tsv", function (data) {
          var genre_data= d3.nest()
          .key(function(d) { return parseInt(d.year);}).sortKeys(d3.ascending)
          .rollup(function(d) { return genres.reduce(
            function(store,genre){
              store[genre] = d3.sum(d, function(line) {
                return line[genre];
              });
              return store;
            },{});
          })
          .entries(data)
          .filter(function(entry){return entry['key']>=1915 && entry['key']<2014;})
          .map(function(entry){
            return genres.map(function(genre){
                return {'Year':entry.key,
                        'Genre':genre,
                        'Count':entry.values[genre]};
                    });
                  })
          .reduce(function(all_data,year_data){
            return all_data.concat(year_data);
          },[]);
          console.log(genre_data);

        svg.selectAll("title_text")
          .data(["Legend"])
          .enter()
          .append("text")
            .attr("x", 600)
            .attr("y", 85)
            .style("font-family", "sans-serif")
            .style("font-size", "10px")
            .style("color", "Black")
            .text(function (d) { return d; });

        svg.selectAll("title_text")
          .data(["Legend"])
          .enter()
          .append("text")
            .attr("x", 600)
            .attr("y", 85)
            .style("font-family", "sans-serif")
            .style("font-size", "10px")
            .style("color", "Black")
            .text(function (d) { return d; });

          var chart = new dimple.chart(svg, genre_data);
          chart.setBounds(60, 50, 525, 325);
          var x_axis = chart.addTimeAxis("x", "Year");
          x_axis.timePeriod = d3.time.years;
          x_axis.timeInterval = 5;
          x_axis.tickFormat = "%Y";
          var y_axis = chart.addMeasureAxis("y", "Count");
          var series = chart.addSeries("Genre", dimple.plot.area);
          series.interpolation = "cardinal";
          var legend = chart.addLegend(600, 100, 100, 200, "Right");
          legend.verticalPadding = 20;
		  legend._getEntries_old = legend._getEntries;
		  legend._getEntries = function()
		  {
		  	// but call the original version,
		  	// then sort the returned array before returning it.
			return legend._getEntries_old.apply(this, arguments).reverse();
	      }
          chart.draw();

		  svg.append("text")
		   .attr("x", 325)
		   .attr("y", 25)
		   .style("text-anchor", "middle")
		   .style("font-family", "sans-serif")
		   .text("Movie Productions By Genre Over Time");
        });
  	  </script>
      <div id="toggleContainer">
		<input id="toggle-on" class="toggle toggle-left" name="toggle" value="false" type="radio" checked
		><label for="toggle-on" class="btn" style="-left:10;padding-right:55">Counts</label>
		<input id="toggle-off" class="toggle toggle-right" name="toggle" value="true" type="radio"
		><label for="toggle-off" class="btn" style="padding-left:10;padding-right:65">Percents</label>
      </div>
    </div>
  </body>
</html>
